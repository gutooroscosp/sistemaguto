<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GutoApp 4.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d0d0d;
        }
        .container {
            max-width: 800px;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-black text-white flex items-center justify-center p-4 min-h-screen">
    <div class="container mx-auto p-6 bg-gray-900 rounded-3xl shadow-2xl border-2 border-gray-700">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">GutoApp 4.0</h1>
            <p class="text-gray-400">Transforme suas fotos e textos com prompts de IA!</p>
        </header>

        <!-- Seção de Imagens -->
        <h2 class="text-3xl font-bold text-white mb-4 mt-8">Edição de Imagens</h2>
        <hr class="border-gray-700 mb-6">
        <main class="space-y-6">
            <div class="bg-gray-800 p-6 rounded-2xl border-2 border-gray-700">
                <label for="fileInputMain" class="block text-xl font-medium text-white mb-2">1. Envie a Foto Principal</label>
                <div class="flex items-center justify-center w-full">
                    <label for="fileInputMain" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-600 border-dashed rounded-xl cursor-pointer bg-gray-700 hover:bg-gray-600 transition-colors">
                        <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p class="mt-2 text-sm text-gray-400">Clique para enviar ou arraste e solte</p>
                        <p id="fileNameMain" class="text-xs text-gray-500 mt-1"></p>
                        <input id="fileInputMain" type="file" class="hidden" accept="image/*" />
                    </label>
                </div>
            </div>
            
            <div class="bg-gray-800 p-6 rounded-2xl border-2 border-gray-700">
                <label for="fileInputDetail" class="block text-xl font-medium text-white mb-2">2. Envie a Foto com o Detalhe (Opcional)</label>
                <div class="flex items-center justify-center w-full">
                    <label for="fileInputDetail" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-600 border-dashed rounded-xl cursor-pointer bg-gray-700 hover:bg-gray-600 transition-colors">
                        <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p class="mt-2 text-sm text-gray-400">Clique para enviar ou arraste e solte</p>
                        <p id="fileNameDetail" class="text-xs text-gray-500 mt-1"></p>
                        <input id="fileInputDetail" type="file" class="hidden" accept="image/*" />
                    </label>
                </div>
            </div>

            <div class="bg-gray-800 p-6 rounded-2xl border-2 border-gray-700">
                <label for="promptInput" class="block text-xl font-medium text-white mb-2">3. Descreva a modificação</label>
                <textarea id="promptInput" rows="4" class="block w-full text-sm text-gray-200 bg-gray-700 rounded-lg border border-gray-600 focus:ring-blue-500 focus:border-blue-500 p-2.5 resize-none placeholder-gray-400" placeholder="Ex: 'coloque o homem no cenário da outra foto' ou 'aplique a tatuagem da outra foto na mão do homem'"></textarea>
            </div>

            <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4">
                <button id="generateButton" class="w-full py-3 px-4 bg-white text-black font-bold text-lg rounded-xl shadow-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    Gerar Imagem
                </button>
                <button id="magicButton" class="w-full py-3 px-4 bg-gray-700 text-white font-bold text-lg rounded-xl shadow-lg hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    Ajuste de Qualidade Mágica
                </button>
            </div>

            <div id="loadingIndicator" class="hidden flex justify-center items-center py-8">
                <div class="spinner w-12 h-12"></div>
            </div>

            <div id="resultContainer" class="hidden bg-gray-800 p-6 rounded-2xl border-2 border-gray-700 text-center">
                <img id="resultImage" class="w-full rounded-xl shadow-lg mb-4" src="" alt="Imagem Gerada">
                <a id="downloadButton" href="#" download="guto_app_image.png" class="inline-block py-2 px-6 bg-white text-black font-bold rounded-xl hover:bg-gray-200 transition-colors">
                    Baixar Imagem
                </a>
            </div>

            <div id="messageBox" class="hidden bg-red-800 text-white p-4 rounded-xl text-center"></div>
        </main>

        <!-- Seção de Correção de Texto -->
        <h2 class="text-3xl font-bold text-white mb-4 mt-12">Corretor de Texto</h2>
        <hr class="border-gray-700 mb-6">
        <main class="space-y-6">
            <div class="bg-gray-800 p-6 rounded-2xl border-2 border-gray-700">
                <label for="textInput" class="block text-xl font-medium text-white mb-2">1. Insira seu texto para correção</label>
                <textarea id="textInput" rows="10" class="block w-full text-sm text-gray-200 bg-gray-700 rounded-lg border border-gray-600 focus:ring-blue-500 focus:border-blue-500 p-2.5 resize-none placeholder-gray-400" placeholder="Digite ou cole seu texto aqui..."></textarea>
            </div>
            
            <button id="correctButton" class="w-full py-3 px-4 bg-white text-black font-bold text-lg rounded-xl shadow-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                Corrigir Texto
            </button>

            <div id="loadingIndicatorText" class="hidden flex justify-center items-center py-8">
                <div class="spinner w-12 h-12"></div>
            </div>

            <div id="resultContainerText" class="hidden bg-gray-800 p-6 rounded-2xl border-2 border-gray-700">
                <h2 class="text-xl font-bold text-white mb-2">Texto Corrigido</h2>
                <div id="correctedText" class="text-gray-200 whitespace-pre-wrap"></div>
            </div>

            <div id="messageBoxText" class="hidden bg-red-800 text-white p-4 rounded-xl text-center"></div>
        </main>
        
        <!-- Seção de Criação de Texto de Marketing -->
        <h2 class="text-3xl font-bold text-white mb-4 mt-12">Criação de Texto de Marketing</h2>
        <hr class="border-gray-700 mb-6">
        <main class="space-y-6">
            <div class="bg-gray-800 p-6 rounded-2xl border-2 border-gray-700">
                <label for="marketingInput" class="block text-xl font-medium text-white mb-2">1. Descreva o que você precisa</label>
                <textarea id="marketingInput" rows="10" class="block w-full text-sm text-gray-200 bg-gray-700 rounded-lg border border-gray-600 focus:ring-blue-500 focus:border-blue-500 p-2.5 resize-none placeholder-gray-400" placeholder="Ex: 'Crie um post para o Instagram sobre o lançamento de uma nova linha de camisetas sustentáveis.'"></textarea>
            </div>
            
            <button id="marketingButton" class="w-full py-3 px-4 bg-white text-black font-bold text-lg rounded-xl shadow-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                Gerar Texto de Marketing
                </button>

            <div id="loadingIndicatorMarketing" class="hidden flex justify-center items-center py-8">
                <div class="spinner w-12 h-12"></div>
            </div>

            <div id="resultContainerMarketing" class="hidden bg-gray-800 p-6 rounded-2xl border-2 border-gray-700">
                <h2 class="text-xl font-bold text-white mb-2">Texto de Marketing</h2>
                <div id="marketingText" class="text-gray-200 whitespace-pre-wrap"></div>
            </div>

            <div id="messageBoxMarketing" class="hidden bg-red-800 text-white p-4 rounded-xl text-center"></div>
        </main>

        <!-- Seção de Renderização de Logo -->
        <h2 class="text-3xl font-bold text-white mb-4 mt-12">Renderização de Logo</h2>
        <hr class="border-gray-700 mb-6">
        <main class="space-y-6">
            <div class="bg-gray-800 p-6 rounded-2xl border-2 border-gray-700">
                <label for="logoInput" class="block text-xl font-medium text-white mb-2">1. Envie seu arquivo de logo</label>
                <div class="flex items-center justify-center w-full">
                    <label for="logoInput" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-600 border-dashed rounded-xl cursor-pointer bg-gray-700 hover:bg-gray-600 transition-colors">
                        <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p class="mt-2 text-sm text-gray-400">Clique para enviar ou arraste e solte</p>
                        <p id="fileNameLogo" class="text-xs text-gray-500 mt-1"></p>
                        <input id="logoInput" type="file" class="hidden" accept="image/*" />
                    </label>
                </div>
            </div>

            <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4">
                <button id="removeBgButton" class="w-full py-3 px-4 bg-white text-black font-bold text-lg rounded-xl shadow-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Remover Fundo (PNG)
                </button>
                <button id="enhanceLogoButton" class="w-full py-3 px-4 bg-gray-700 text-white font-bold text-lg rounded-xl shadow-lg hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Aumentar Qualidade (PNG)
                </button>
            </div>
            
            <!-- Nova Seção para Identificação de Fonte -->
            <div class="bg-gray-800 p-6 rounded-2xl border-2 border-gray-700">
                <h3 class="text-xl font-medium text-white mb-4">Identificação de Fonte</h3>
                <button id="fontButton" class="w-full py-3 px-4 bg-gray-700 text-white font-bold text-lg rounded-xl shadow-lg hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Identificar Fonte
                </button>
            </div>

            <div id="loadingIndicatorLogo" class="hidden flex justify-center items-center py-8">
                <div class="spinner w-12 h-12"></div>
            </div>

            <div id="resultContainerLogo" class="hidden bg-gray-800 p-6 rounded-2xl border-2 border-gray-700 text-center">
                <img id="resultLogo" class="w-full rounded-xl shadow-lg mb-4" src="" alt="Logo Renderizado">
                <a id="downloadLogoButton" href="#" download="guto_app_logo.png" class="inline-block py-2 px-6 bg-white text-black font-bold rounded-xl hover:bg-gray-200 transition-colors">
                    Baixar Logo
                </a>
            </div>

            <div id="resultContainerFont" class="hidden bg-gray-800 p-6 rounded-2xl border-2 border-gray-700">
                <h2 class="text-xl font-bold text-white mb-2">Fonte Identificada</h2>
                <div id="fontResult" class="text-gray-200"></div>
            </div>

            <div id="messageBoxLogo" class="hidden bg-red-800 text-white p-4 rounded-xl text-center"></div>
        </main>
        
        <!-- Seção de Busca de Música -->
        <h2 class="text-3xl font-bold text-white mb-4 mt-12">Busca de Música</h2>
        <hr class="border-gray-700 mb-6">
        <main class="space-y-6">
            <div class="bg-gray-800 p-6 rounded-2xl border-2 border-gray-700">
                <label for="musicInput" class="block text-xl font-medium text-white mb-2">1. Digite o estilo de música que você procura</label>
                <textarea id="musicInput" rows="4" class="block w-full text-sm text-gray-200 bg-gray-700 rounded-lg border border-gray-600 focus:ring-blue-500 focus:border-blue-500 p-2.5 resize-none placeholder-gray-400" placeholder="Ex: 'Música eletrônica para relaxar', 'Rock acústico otimista'"></textarea>
            </div>
            
            <button id="musicButton" class="w-full py-3 px-4 bg-white text-black font-bold text-lg rounded-xl shadow-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                Buscar Músicas
            </button>

            <div id="loadingIndicatorMusic" class="hidden flex justify-center items-center py-8">
                <div class="spinner w-12 h-12"></div>
            </div>
            
            <div id="resultContainerMusic" class="hidden bg-gray-800 p-6 rounded-2xl border-2 border-gray-700">
                <h2 class="text-xl font-bold text-white mb-2">Músicas Sem Direitos Autorais</h2>
                <div id="musicResult" class="text-gray-200"></div>
                <p class="text-sm text-gray-500 mt-4">Nota: O download direto não é possível. Clique nos links para ser redirecionado a uma busca de músicas em plataformas externas como o Pixabay.</p>
            </div>

            <div id="messageBoxMusic" class="hidden bg-red-800 text-white p-4 rounded-xl text-center"></div>
        </main>
    </div>

    <script>
        // Lógica para Edição de Imagens
        const fileInputMain = document.getElementById('fileInputMain');
        const fileInputDetail = document.getElementById('fileInputDetail');
        const promptInput = document.getElementById('promptInput');
        const generateButton = document.getElementById('generateButton');
        const magicButton = document.getElementById('magicButton');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const resultContainer = document.getElementById('resultContainer');
        const resultImage = document.getElementById('resultImage');
        const downloadButton = document.getElementById('downloadButton');
        const messageBox = document.getElementById('messageBox');
        const fileNameMainSpan = document.getElementById('fileNameMain');
        const fileNameDetailSpan = document.getElementById('fileNameDetail');

        let uploadedImageBase64Main = null;
        let uploadedImageBase64Detail = null;
        let uploadedImageMimeTypeMain = null;
        let uploadedImageMimeTypeDetail = null;

        function showMessage(message, type = 'error') {
            if (type === 'error') {
                console.error("Mensagem de Erro:", message); 
                messageBox.className = 'bg-red-800 text-white p-4 rounded-xl text-center block';
            } else {
                console.log("Mensagem:", message); 
                messageBox.className = 'bg-green-800 text-white p-4 rounded-xl text-center block';
            }
            messageBox.textContent = message;
            messageBox.classList.remove('hidden');
        }

        function hideMessage() {
            messageBox.classList.add('hidden');
        }

        fileInputMain.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                fileNameMainSpan.textContent = file.name;
                const reader = new FileReader();
                reader.onload = (event) => {
                    uploadedImageBase64Main = event.target.result.split(',')[1];
                    uploadedImageMimeTypeMain = file.type;
                    showMessage("Foto principal carregada com sucesso!", 'success');
                };
                reader.readAsDataURL(file);
            }
        });

        fileInputDetail.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                fileNameDetailSpan.textContent = file.name;
                const reader = new FileReader();
                reader.onload = (event) => {
                    uploadedImageBase64Detail = event.target.result.split(',')[1];
                    uploadedImageMimeTypeDetail = file.type;
                    showMessage("Foto com detalhe carregada com sucesso!", 'success');
                };
                reader.readAsDataURL(file);
            }
        });

        async function generateImage(prompt, image1, mimeType1, image2 = null, mimeType2 = null) {
            hideMessage();
            resultContainer.classList.add('hidden');
            
            if (!image1) {
                showMessage("Por favor, envie a foto principal primeiro.");
                return;
            }
            
            loadingIndicator.classList.remove('hidden');
            generateButton.disabled = true;
            magicButton.disabled = true;

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const parts = [{ text: prompt }];
            parts.push({
                inlineData: {
                    mimeType: mimeType1,
                    data: image1
                }
            });
            if (image2) {
                parts.push({
                    inlineData: {
                        mimeType: mimeType2,
                        data: image2
                    }
                });
            }

            const payload = {
                contents: [{ parts }],
                generationConfig: {
                    responseModalities: ["TEXT", "IMAGE"]
                }
            };

            let retryCount = 0;
            const maxRetries = 3;

            async function fetchWithExponentialBackoff() {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`Erro de rede: ${response.statusText}`);
                    }

                    const result = await response.json();
                    const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                    if (!base64Data) {
                        throw new Error("Não foi possível gerar a imagem. Tente uma descrição diferente.");
                    }

                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    resultImage.src = imageUrl;
                    downloadButton.href = imageUrl;
                    resultContainer.classList.remove('hidden');
                } catch (error) {
                    if (retryCount < maxRetries) {
                        retryCount++;
                        const delay = Math.pow(2, retryCount) * 1000;
                        await new Promise(res => setTimeout(res, delay));
                        return await fetchWithExponentialBackoff();
                    } else {
                        showMessage(`Erro ao gerar a imagem: ${error.message}`);
                        console.error("Erro completo:", error);
                    }
                } finally {
                    loadingIndicator.classList.add('hidden');
                    generateButton.disabled = false;
                    magicButton.disabled = false;
                }
            }
            fetchWithExponentialBackoff();
        }

        // Event listener para o botão "Gerar Imagem"
        generateButton.addEventListener('click', () => {
            const prompt = promptInput.value.trim();
            if (!prompt) {
                showMessage("Por favor, insira uma descrição para a modificação.");
                return;
            }
            generateImage(prompt, uploadedImageBase64Main, uploadedImageMimeTypeMain, uploadedImageBase64Detail, uploadedImageMimeTypeDetail);
        });

        // Event listener para o botão "Ajuste de Qualidade Mágica"
        magicButton.addEventListener('click', () => {
            const magicPrompt = "Ajuste a qualidade da imagem para um padrão luxuoso e profissional, com iluminação ideal, cores perfeitas e detalhes impecáveis.";
            generateImage(magicPrompt, uploadedImageBase64Main, uploadedImageMimeTypeMain);
        });

        // Lógica para Corretor de Texto
        const textInput = document.getElementById('textInput');
        const correctButton = document.getElementById('correctButton');
        const loadingIndicatorText = document.getElementById('loadingIndicatorText');
        const resultContainerText = document.getElementById('resultContainerText');
        const correctedText = document.getElementById('correctedText');
        const messageBoxText = document.getElementById('messageBoxText');

        function showMessageText(message, type = 'error') {
            if (type === 'error') {
                console.error("Mensagem de Erro:", message); 
                messageBoxText.className = 'bg-red-800 text-white p-4 rounded-xl text-center block';
            } else {
                console.log("Mensagem:", message); 
                messageBoxText.className = 'bg-green-800 text-white p-4 rounded-xl text-center block';
            }
            messageBoxText.textContent = message;
            messageBoxText.classList.remove('hidden');
        }

        function hideMessageText() {
            messageBoxText.classList.add('hidden');
        }

        async function correctText(text) {
            hideMessageText();
            resultContainerText.classList.add('hidden');
            
            if (text.trim() === "") {
                showMessageText("Por favor, insira um texto para correção.");
                return;
            }
            
            loadingIndicatorText.classList.remove('hidden');
            correctButton.disabled = true;

            const systemPrompt = "Você é um professor de português e gramática brasileiro. Corrija o texto fornecido pelo usuário, focando na ortografia, gramática e nas melhores práticas da norma culta brasileira. Mantenha o conteúdo e a estrutura originais, alterando apenas o que for necessário para a correção. Não inclua comentários adicionais ou explicações sobre as correções, apenas forneça o texto corrigido.";
            const userQuery = `Corrija o seguinte texto:\n\n"${text}"`;
            
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            let retryCount = 0;
            const maxRetries = 3;

            async function fetchWithExponentialBackoff() {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`Erro de rede: ${response.statusText}`);
                    }

                    const result = await response.json();
                    const corrected = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (!corrected) {
                        throw new Error("Não foi possível corrigir o texto. Tente novamente.");
                    }

                    correctedText.textContent = corrected;
                    resultContainerText.classList.remove('hidden');
                } catch (error) {
                    if (retryCount < maxRetries) {
                        retryCount++;
                        const delay = Math.pow(2, retryCount) * 1000;
                        await new Promise(res => setTimeout(res, delay));
                        return await fetchWithExponentialBackoff();
                    } else {
                        showMessageText(`Erro ao corrigir o texto: ${error.message}`);
                        console.error("Erro completo:", error);
                    }
                } finally {
                    loadingIndicatorText.classList.add('hidden');
                    correctButton.disabled = false;
                }
            }
            fetchWithExponentialBackoff();
        }

        correctButton.addEventListener('click', () => {
            correctText(textInput.value);
        });

        // Lógica para Criação de Texto de Marketing
        const marketingInput = document.getElementById('marketingInput');
        const marketingButton = document.getElementById('marketingButton');
        const loadingIndicatorMarketing = document.getElementById('loadingIndicatorMarketing');
        const resultContainerMarketing = document.getElementById('resultContainerMarketing');
        const marketingText = document.getElementById('marketingText');
        const messageBoxMarketing = document.getElementById('messageBoxMarketing');

        function showMessageMarketing(message, type = 'error') {
            if (type === 'error') {
                console.error("Mensagem de Erro:", message);
                messageBoxMarketing.className = 'bg-red-800 text-white p-4 rounded-xl text-center block';
            } else {
                console.log("Mensagem:", message);
                messageBoxMarketing.className = 'bg-green-800 text-white p-4 rounded-xl text-center block';
            }
            messageBoxMarketing.textContent = message;
            messageBoxMarketing.classList.remove('hidden');
        }

        function hideMessageMarketing() {
            messageBoxMarketing.classList.add('hidden');
        }

        async function createMarketingText(text) {
            hideMessageMarketing();
            resultContainerMarketing.classList.add('hidden');
            
            if (text.trim() === "") {
                showMessageMarketing("Por favor, insira uma descrição para o texto de marketing.");
                return;
            }
            
            loadingIndicatorMarketing.classList.remove('hidden');
            marketingButton.disabled = true;

            const systemPrompt = "Você é um professor de marketing com mais de 30 anos de mercado, focado em comércio e especializado em vendas e mídias sociais. Produza um texto de alta qualidade, relevante e atraente, focado no prompt do usuário.";
            const userQuery = `Produza o seguinte texto de marketing:\n\n"${text}"`;
            
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            let retryCount = 0;
            const maxRetries = 3;

            async function fetchWithExponentialBackoff() {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`Erro de rede: ${response.statusText}`);
                    }

                    const result = await response.json();
                    const createdText = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (!createdText) {
                        throw new Error("Não foi possível criar o texto. Tente uma descrição diferente.");
                    }

                    marketingText.textContent = createdText;
                    resultContainerMarketing.classList.remove('hidden');
                } catch (error) {
                    if (retryCount < maxRetries) {
                        retryCount++;
                        const delay = Math.pow(2, retryCount) * 1000;
                        await new Promise(res => setTimeout(res, delay));
                        return await fetchWithExponentialBackoff();
                    } else {
                        showMessageMarketing(`Erro ao criar o texto: ${error.message}`);
                        console.error("Erro completo:", error);
                    }
                } finally {
                    loadingIndicatorMarketing.classList.add('hidden');
                    marketingButton.disabled = false;
                }
            }
            fetchWithExponentialBackoff();
        }

        marketingButton.addEventListener('click', () => {
            createMarketingText(marketingInput.value);
        });

        // Lógica para Renderização de Logo
        const logoInput = document.getElementById('logoInput');
        const removeBgButton = document.getElementById('removeBgButton');
        const enhanceLogoButton = document.getElementById('enhanceLogoButton');
        const fontButton = document.getElementById('fontButton');
        const loadingIndicatorLogo = document.getElementById('loadingIndicatorLogo');
        const resultContainerLogo = document.getElementById('resultContainerLogo');
        const resultLogo = document.getElementById('resultLogo');
        const downloadLogoButton = document.getElementById('downloadLogoButton');
        const messageBoxLogo = document.getElementById('messageBoxLogo');
        const fileNameLogoSpan = document.getElementById('fileNameLogo');
        const resultContainerFont = document.getElementById('resultContainerFont');
        const fontResult = document.getElementById('fontResult');

        let uploadedLogoBase64 = null;
        let uploadedLogoMimeType = null;

        function showMessageLogo(message, type = 'error') {
            if (type === 'error') {
                console.error("Mensagem de Erro:", message); 
                messageBoxLogo.className = 'bg-red-800 text-white p-4 rounded-xl text-center block';
            } else {
                console.log("Mensagem:", message); 
                messageBoxLogo.className = 'bg-green-800 text-white p-4 rounded-xl text-center block';
            }
            messageBoxLogo.textContent = message;
            messageBoxLogo.classList.remove('hidden');
        }

        function hideMessageLogo() {
            messageBoxLogo.classList.add('hidden');
        }

        logoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                fileNameLogoSpan.textContent = file.name;
                const reader = new FileReader();
                reader.onload = (event) => {
                    const base64String = event.target.result;
                    uploadedLogoBase64 = base64String.split(',')[1];
                    uploadedLogoMimeType = file.type;
                    showMessageLogo("Logo carregado com sucesso!", 'success');
                    removeBgButton.disabled = false;
                    enhanceLogoButton.disabled = false;
                    fontButton.disabled = false;
                };
                reader.readAsDataURL(file);
            }
        });

        async function processLogoImage(prompt, mimeType) {
            hideMessageLogo();
            resultContainerLogo.classList.add('hidden');
            resultContainerFont.classList.add('hidden');
            
            if (!uploadedLogoBase64) {
                showMessageLogo("Por favor, envie o arquivo do logo primeiro.");
                return;
            }
            
            loadingIndicatorLogo.classList.remove('hidden');
            removeBgButton.disabled = true;
            enhanceLogoButton.disabled = true;
            fontButton.disabled = true;

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const parts = [
                { text: prompt },
                {
                    inlineData: {
                        mimeType: mimeType,
                        data: uploadedLogoBase64
                    }
                }
            ];

            const payload = {
                contents: [{ parts }],
                generationConfig: {
                    responseModalities: ["TEXT", "IMAGE"]
                }
            };

            let retryCount = 0;
            const maxRetries = 3;

            async function fetchWithExponentialBackoff() {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`Erro de rede: ${response.statusText}`);
                    }

                    const result = await response.json();
                    const base64Data = result?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;

                    if (!base64Data) {
                        throw new Error("Não foi possível processar o logo. Tente novamente.");
                    }
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    resultLogo.src = imageUrl;
                    downloadLogoButton.href = imageUrl;
                    resultContainerLogo.classList.remove('hidden');

                } catch (error) {
                    if (retryCount < maxRetries) {
                        retryCount++;
                        const delay = Math.pow(2, retryCount) * 1000;
                        await new Promise(res => setTimeout(res, delay));
                        return await fetchWithExponentialBackoff();
                    } else {
                        showMessageLogo(`Erro ao processar o logo: ${error.message}`);
                        console.error("Erro completo:", error);
                    }
                } finally {
                    loadingIndicatorLogo.classList.add('hidden');
                    removeBgButton.disabled = false;
                    enhanceLogoButton.disabled = false;
                    fontButton.disabled = false;
                }
            }
            fetchWithExponentialBackoff();
        }

        async function processLogoText(prompt, mimeType) {
            hideMessageLogo();
            resultContainerLogo.classList.add('hidden');
            resultContainerFont.classList.add('hidden');

            if (!uploadedLogoBase64) {
                showMessageLogo("Por favor, envie o arquivo do logo primeiro.");
                return;
            }

            loadingIndicatorLogo.classList.remove('hidden');
            removeBgButton.disabled = true;
            enhanceLogoButton.disabled = true;
            fontButton.disabled = true;

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const parts = [
                { text: prompt },
                {
                    inlineData: {
                        mimeType: mimeType,
                        data: uploadedLogoBase64
                    }
                }
            ];

            const payload = {
                contents: [{ parts }],
            };

            let retryCount = 0;
            const maxRetries = 3;

            async function fetchWithExponentialBackoff() {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`Erro de rede: ${response.statusText}`);
                    }

                    const result = await response.json();
                    const fontData = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (!fontData) {
                        throw new Error("Não foi possível identificar a fonte. Tente novamente.");
                    }
                    fontResult.innerHTML = `A fonte utilizada é: <strong>${fontData}</strong>`;
                    resultContainerFont.classList.remove('hidden');
                } catch (error) {
                    if (retryCount < maxRetries) {
                        retryCount++;
                        const delay = Math.pow(2, retryCount) * 1000;
                        await new Promise(res => setTimeout(res, delay));
                        return await fetchWithExponentialBackoff();
                    } else {
                        showMessageLogo(`Erro ao processar o logo: ${error.message}`);
                        console.error("Erro completo:", error);
                    }
                } finally {
                    loadingIndicatorLogo.classList.add('hidden');
                    removeBgButton.disabled = false;
                    enhanceLogoButton.disabled = false;
                    fontButton.disabled = false;
                }
            }
            fetchWithExponentialBackoff();
        }


        removeBgButton.addEventListener('click', () => {
            const prompt = "Crie uma imagem do objeto principal com o fundo completamente transparente. Mantenha a qualidade e clareza do objeto. O resultado deve ser um arquivo PNG.";
            processLogoImage(prompt, uploadedLogoMimeType);
        });

        enhanceLogoButton.addEventListener('click', () => {
            const prompt = "Aumente a resolução e a qualidade do logo para um padrão profissional de alta resolução. Mantenha os detalhes e a clareza. Não gere um arquivo vetorial, apenas melhore a imagem.";
            processLogoImage(prompt, uploadedLogoMimeType);
        });
        
        fontButton.addEventListener('click', () => {
            const prompt = "Analise o logo e identifique a fonte utilizada. Responda apenas com o nome da fonte, sem qualquer outra informação.";
            processLogoText(prompt, uploadedLogoMimeType);
        });

        // Lógica para Busca de Música
        const musicInput = document.getElementById('musicInput');
        const musicButton = document.getElementById('musicButton');
        const loadingIndicatorMusic = document.getElementById('loadingIndicatorMusic');
        const resultContainerMusic = document.getElementById('resultContainerMusic');
        const musicResult = document.getElementById('musicResult');
        const messageBoxMusic = document.getElementById('messageBoxMusic');

        function showMessageMusic(message, type = 'error') {
            if (type === 'error') {
                console.error("Mensagem de Erro:", message); 
                messageBoxMusic.className = 'bg-red-800 text-white p-4 rounded-xl text-center block';
            } else {
                console.log("Mensagem:", message); 
                messageBoxMusic.className = 'bg-green-800 text-white p-4 rounded-xl text-center block';
            }
            messageBoxMusic.textContent = message;
            messageBoxMusic.classList.remove('hidden');
        }

        function hideMessageMusic() {
            messageBoxMusic.classList.add('hidden');
        }

        async function searchMusic(style) {
            hideMessageMusic();
            resultContainerMusic.classList.add('hidden');
            
            if (style.trim() === "") {
                showMessageMusic("Por favor, digite um estilo de música para buscar.");
                return;
            }
            
            loadingIndicatorMusic.classList.remove('hidden');
            musicButton.disabled = true;

            const systemPrompt = "Você é um assistente de busca de músicas. Crie uma lista de 5 músicas fictícias sem direitos autorais com títulos e artistas baseados no estilo fornecido. Para cada música, forneça um link de busca simulado. Formato: 'Título da Música' - 'Artista' - link de busca. Responda apenas com a lista, um título, artista e link por linha. Use como base a busca por músicas em plataformas como o Pixabay. Exemplo: Título - Artista - https://pixabay.com/music/search/rock";
            const userQuery = `Gere uma lista de músicas para o estilo: "${style}"`;
            
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            let retryCount = 0;
            const maxRetries = 3;

            async function fetchWithExponentialBackoff() {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`Erro de rede: ${response.statusText}`);
                    }

                    const result = await response.json();
                    const musicList = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (!musicList) {
                        throw new Error("Não foi possível encontrar músicas. Tente um estilo diferente.");
                    }

                    const musicArray = musicList.split('\n').filter(item => item.trim() !== '');
                    let htmlList = '<ul>';
                    musicArray.forEach(item => {
                        const parts = item.split(' - ');
                        if (parts.length >= 3) {
                            const title = parts[0].trim();
                            const artist = parts[1].trim();
                            const url = parts.slice(2).join(' - ').trim(); // Join parts back in case the URL contains hyphens
                            htmlList += `<li class="my-2"><a href="${url}" target="_blank" class="text-blue-400 hover:underline">${title}</a> - ${artist}</li>`;
                        } else {
                            htmlList += `<li class="my-2">${item}</li>`;
                        }
                    });
                    htmlList += '</ul>';

                    musicResult.innerHTML = htmlList;
                    resultContainerMusic.classList.remove('hidden');
                } catch (error) {
                    if (retryCount < maxRetries) {
                        retryCount++;
                        const delay = Math.pow(2, retryCount) * 1000;
                        await new Promise(res => setTimeout(res, delay));
                        return await fetchWithExponentialBackoff();
                    } else {
                        showMessageMusic(`Erro ao buscar músicas: ${error.message}`);
                        console.error("Erro completo:", error);
                    }
                } finally {
                    loadingIndicatorMusic.classList.add('hidden');
                    musicButton.disabled = false;
                }
            }
            fetchWithExponentialBackoff();
        }

        musicButton.addEventListener('click', () => {
            searchMusic(musicInput.value);
        });
    </script>
</body>
</html>
